# DeSciData 金融政策前端测试指南

本指南提供了如何从前端测试 DeSciData 平台金融政策功能的详细步骤。通过这些测试，您可以验证智能合约中实现的金融政策功能是否正确地集成到前端界面中。

## 测试环境准备

在开始测试之前，请确保您已经完成以下准备工作：

1. 启动本地区块链网络（Hardhat 或 Ganache）
2. 部署 DeSciData 智能合约
3. 启动前端开发服务器
4. 准备多个测试钱包账户（至少需要研究者、赞助商和平台管理员账户）

```bash
# 1. 启动本地区块链
npx hardhat node

# 2. 部署智能合约
npx hardhat run scripts/deploy.js --network localhost

# 3. 启动前端服务器
cd frontend
npm run dev
```

## 测试用例 1: 资助实验功能

### 测试步骤

1. 使用研究者账户登录并创建一个新实验
   - 打开浏览器访问 `http://localhost:3000/dashboard`
   - 点击 "创建实验" 按钮
   - 填写实验详情，设置资金目标为 10 ETH，截止日期为 30 天后
   - 提交实验创建表单

2. 使用赞助商账户资助实验
   - 退出研究者账户，使用赞助商账户登录
   - 导航到实验详情页面 `http://localhost:3000/experiment/[实验ID]`
   - 点击 "支持此研究" 按钮
   - 在弹出的模态框中选择资助金额（例如 2 ETH）
   - 确认交易

### 验证点

- 实验资金进度条应该更新，显示已筹集资金占总目标的百分比
- 交易历史应该显示您的资助记录
- 合约状态应该记录您的贡献金额
- 前端应该显示平台费用信息（5%，仅在成功资助时收取）

## 测试用例 2: 退款机制

### 测试步骤

1. 使用研究者账户创建一个新实验
   - 设置资金目标为 10 ETH，截止日期为较短时间（例如 2 分钟，便于测试）

2. 使用赞助商账户部分资助实验
   - 资助金额应小于目标金额（例如 4 ETH）

3. 等待截止日期过后
   - 等待设定的截止时间过后（如果设置为 2 分钟，则等待 2 分钟）

4. 请求退款
   - 在实验详情页面，应该出现 "申请退款" 按钮
   - 点击该按钮并确认交易

### 验证点

- 退款按钮应该只在以下条件都满足时才显示：
  - 截止日期已过
  - 资金目标未达成
  - 用户有贡献记录
- 退款交易成功后，用户的钱包余额应该增加（减去 gas 费用）
- 前端应该显示退款成功的通知
- 用户的贡献记录应该重置为 0

## 测试用例 3: 资金成功处理与平台费用

### 测试步骤

1. 使用研究者账户创建一个新实验
   - 设置资金目标为 10 ETH，截止日期为较短时间

2. 使用多个赞助商账户完全资助实验
   - 确保总资助金额达到或超过目标金额

3. 等待截止日期过后

4. 处理成功资助
   - 使用研究者账户登录
   - 导航到实验详情页面
   - 应该出现 "处理资金" 按钮
   - 点击该按钮并确认交易

### 验证点

- 前端应该显示平台收取了 5% 的费用
- 研究者应该收到 95% 的资金
- 实验状态应该更新为 "已资助"
- 前端应该显示资金分配详情

## 测试用例 4: 收益分配

### 测试步骤

1. 使用平台管理员账户登录

2. 导航到管理面板 `http://localhost:3000/admin`

3. 记录收益
   - 在管理面板中找到 "记录收益" 功能
   - 输入收益金额（例如 1 ETH）
   - 提交交易

4. 分配季度收益
   - 在管理面板中找到 "分配季度收益" 功能
   - 点击 "分配" 按钮并确认交易

### 验证点

- 前端应该显示收益分配百分比：70% 研究者，20% 赞助商，10% 平台
- 交易成功后，应该显示分配详情
- 研究者和赞助商的账户余额应该增加
- 平台储备金应该增加

## 前端显示验证

在所有测试中，请特别注意以下前端显示元素是否正确：

1. 金融政策信息
   - 导航到 `http://localhost:3000/crowdfunding` 页面
   - 验证页面是否显示正确的平台费用（5%）
   - 验证页面是否显示全额退款保证
   - 验证页面是否显示正确的收益分配百分比（70/20/10）

2. 实验详情页面
   - 验证资金进度显示是否准确
   - 验证是否显示平台费用信息
   - 验证是否显示退款政策信息

3. 用户仪表板
   - 验证用户的投资记录是否准确
   - 验证收益分配记录是否正确显示

## 自动化测试

除了手动测试外，您还可以运行我们提供的自动化测试脚本：

```bash
# 运行前端集成测试
npx hardhat test test/FinancialPolicyFrontendTest.js
```

这个测试脚本模拟了前端与智能合约的交互，验证了金融政策的各个方面是否按预期工作。

## 常见问题排查

1. **交易失败**
   - 检查钱包余额是否足够（包括 gas 费用）
   - 确认您使用的是正确的账户
   - 检查合约地址是否正确配置

2. **退款按钮未显示**
   - 确认截止日期已过
   - 确认资金目标未达成
   - 确认您有贡献记录

3. **收益分配不正确**
   - 检查合约中的百分比常量是否与前端显示一致
   - 确认您使用的是管理员账户

## 结论

通过完成上述测试，您可以全面验证 DeSciData 平台的金融政策功能是否正确实现并集成到前端界面中。这些测试覆盖了资金募集、退款机制、平台费用和收益分配等关键功能，确保用户体验符合预期。

如果您在测试过程中遇到任何问题，请参考我们的 [故障排除指南](/docs/Troubleshooting.md) 或联系开发团队获取支持。
