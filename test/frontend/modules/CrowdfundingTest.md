# 众筹与金融政策测试计划

本文档详细描述了如何测试 DeSciData 平台的众筹和金融政策功能，确保这些关键功能在前端正确实现并与智能合约正确集成。

## 测试前提

- 已部署 DeSciData 智能合约
- 前端服务器正在运行
- 准备了多个测试钱包（研究者、赞助商、管理员）
- 每个钱包中有足够的测试 ETH

## 测试用例

### 1. 众筹页面功能测试

#### 1.1 众筹页面内容验证

**目标**: 验证众筹页面正确显示所有必要信息

**步骤**:
1. 访问 `http://localhost:3000/crowdfunding`
2. 检查页面内容

**验证点**:
- [ ] 页面应显示金融政策概述
- [ ] 应显示全额退款保证信息
- [ ] 应显示 5% 平台费用结构（仅适用于成功资助的项目）
- [ ] 应显示低风险投资策略（国债）信息
- [ ] 应显示季度收益分配模型信息
- [ ] 页面应有明确的行动号召按钮（如"浏览项目"）

#### 1.2 众筹项目列表

**目标**: 验证众筹页面正确显示可资助的实验项目

**步骤**:
1. 访问 `http://localhost:3000/crowdfunding`
2. 浏览项目列表

**验证点**:
- [ ] 应显示所有可资助的实验项目
- [ ] 每个项目应显示标题、描述、资金目标、当前资金和进度条
- [ ] 项目卡片应有明确的"查看详情"或类似按钮
- [ ] 如果没有项目，应显示适当的空状态提示

### 2. 实验资助功能测试

#### 2.1 创建可资助实验

**目标**: 验证研究者能够创建可资助的实验

**步骤**:
1. 使用研究者账户登录
2. 访问 `http://localhost:3000/dashboard`
3. 点击"创建实验"按钮
4. 填写实验详情，包括:
   - 标题: "量子计算在药物发现中的应用"
   - 描述: "研究量子算法如何加速药物分子筛选过程"
   - 资金目标: 10 ETH
   - 截止日期: 当前日期 + 30 天
5. 提交表单

**验证点**:
- [ ] 表单应成功提交
- [ ] 应显示成功创建的确认消息
- [ ] 新创建的实验应出现在研究者的项目列表中
- [ ] 新创建的实验应出现在众筹页面的项目列表中

#### 2.2 资助实验流程

**目标**: 验证赞助商能够资助实验

**步骤**:
1. 使用赞助商账户登录
2. 访问 `http://localhost:3000/experiment/[实验ID]`（使用上一步创建的实验ID）
3. 查看实验详情
4. 点击"支持此研究"按钮
5. 在弹出的模态框中:
   - 检查显示的资助信息
   - 输入资助金额: 2 ETH
   - 点击确认按钮
6. 在 MetaMask 中确认交易

**验证点**:
- [ ] 资助模态框应正确显示实验信息和平台费用说明
- [ ] 交易成功后应显示确认消息
- [ ] 实验的资金进度条应更新
- [ ] 实验的当前资金金额应增加 2 ETH
- [ ] 赞助商的贡献应记录在交易历史中

#### 2.3 多赞助商资助测试

**目标**: 验证多个赞助商能够资助同一实验

**步骤**:
1. 使用第二个赞助商账户重复上述资助步骤，资助金额: 3 ETH
2. 使用第三个赞助商账户重复上述资助步骤，资助金额: 5 ETH

**验证点**:
- [ ] 每次交易后，实验的资金进度条应正确更新
- [ ] 实验的当前资金金额应累计增加（总计 10 ETH）
- [ ] 当资金达到目标时，实验状态应更新为"资金已满"
- [ ] 每个赞助商的贡献应正确记录

### 3. 退款机制测试

#### 3.1 未达资金目标的退款测试

**目标**: 验证当实验未达到资金目标时，赞助商能够获得退款

**步骤**:
1. 使用研究者账户创建一个新实验:
   - 资金目标: 10 ETH
   - 截止日期: 当前日期 + 2 分钟（便于测试）
2. 使用赞助商账户资助该实验 4 ETH
3. 等待截止日期过后（2 分钟）
4. 刷新实验页面
5. 检查是否出现"申请退款"按钮
6. 点击"申请退款"按钮
7. 在 MetaMask 中确认交易

**验证点**:
- [ ] 截止日期过后，实验状态应更新为"资金未达目标"
- [ ] "申请退款"按钮应仅对有贡献的赞助商显示
- [ ] 退款交易成功后应显示确认消息
- [ ] 赞助商的钱包余额应增加（减去 gas 费用）
- [ ] 赞助商的贡献记录应重置为 0

#### 3.2 达到资金目标时退款不可用测试

**目标**: 验证当实验达到资金目标时，退款功能不可用

**步骤**:
1. 使用研究者账户创建一个新实验:
   - 资金目标: 10 ETH
   - 截止日期: 当前日期 + 2 分钟
2. 使用多个赞助商账户完全资助该实验（总计 10 ETH）
3. 等待截止日期过后（2 分钟）
4. 刷新实验页面
5. 检查是否有"申请退款"按钮

**验证点**:
- [ ] 截止日期过后，实验状态应更新为"资金已达目标"
- [ ] 页面不应显示"申请退款"按钮
- [ ] 如果尝试通过 API 直接调用退款功能，应返回适当的错误消息

### 4. 资金处理与平台费用测试

#### 4.1 成功资助后的资金处理

**目标**: 验证实验成功资助后，资金能够正确处理并收取平台费用

**步骤**:
1. 使用上一测试中成功资助的实验
2. 使用研究者账户登录
3. 访问实验详情页面
4. 检查是否出现"处理资金"按钮
5. 点击"处理资金"按钮
6. 在 MetaMask 中确认交易

**验证点**:
- [ ] 交易成功后应显示确认消息
- [ ] 应显示平台收取了 5% 的费用（0.5 ETH）
- [ ] 研究者应收到 95% 的资金（9.5 ETH）
- [ ] 实验状态应更新为"资金已处理"
- [ ] 应显示资金分配详情

#### 4.2 平台费用累计验证

**目标**: 验证平台费用是否正确累计

**步骤**:
1. 使用管理员账户登录
2. 访问 `http://localhost:3000/admin`
3. 查看平台费用统计

**验证点**:
- [ ] 管理面板应显示累计的平台费用
- [ ] 费用金额应包括之前测试中收取的 0.5 ETH
- [ ] 应显示费用收取的历史记录

### 5. 收益分配测试

#### 5.1 收益记录

**目标**: 验证管理员能够记录平台收益

**步骤**:
1. 使用管理员账户登录
2. 访问 `http://localhost:3000/admin`
3. 找到"记录收益"功能
4. 输入收益金额: 1 ETH
5. 提交交易

**验证点**:
- [ ] 交易成功后应显示确认消息
- [ ] 收益应记录在平台的收益历史中
- [ ] 总收益金额应更新

#### 5.2 季度收益分配

**目标**: 验证管理员能够分配季度收益

**步骤**:
1. 使用管理员账户登录
2. 访问 `http://localhost:3000/admin`
3. 找到"分配季度收益"功能
4. 点击"分配"按钮
5. 在 MetaMask 中确认交易

**验证点**:
- [ ] 交易成功后应显示确认消息
- [ ] 应显示收益分配详情:
  - 70% 分配给研究者
  - 20% 分配给赞助商
  - 10% 分配给平台
- [ ] 分配历史应更新
- [ ] 可以验证研究者和赞助商的余额是否增加

### 6. 前端显示与用户体验测试

#### 6.1 资金进度显示

**目标**: 验证资金进度显示是否准确

**步骤**:
1. 访问多个不同资金状态的实验页面
2. 检查资金进度条和百分比显示

**验证点**:
- [ ] 进度条长度应与资金百分比匹配
- [ ] 百分比计算应准确（已筹资金/目标资金 * 100%）
- [ ] 对于资金已满的实验，进度条应显示 100%
- [ ] 对于未达资金目标的过期实验，应有明确标识

#### 6.2 金融政策信息显示

**目标**: 验证金融政策信息在各页面的显示是否一致

**步骤**:
1. 访问以下页面，检查金融政策信息:
   - 众筹页面
   - 实验详情页面
   - 资助模态框
   - 用户仪表板

**验证点**:
- [ ] 所有页面的金融政策信息应保持一致
- [ ] 平台费用（5%）信息应清晰可见
- [ ] 退款保证应明确说明
- [ ] 收益分配比例应准确显示

#### 6.3 响应式设计测试

**目标**: 验证众筹和金融相关页面在不同设备上的显示效果

**步骤**:
1. 使用浏览器开发者工具模拟不同设备尺寸
2. 检查页面布局和元素排列

**验证点**:
- [ ] 页面应在桌面、平板和手机尺寸下正常显示
- [ ] 按钮和交互元素应有足够大小，便于触摸操作
- [ ] 文本应清晰可读，不应出现溢出或重叠
- [ ] 资金进度条应在所有设备上正确显示

## 测试数据记录表

| 测试用例 | 测试日期 | 测试结果 | 问题描述 | 修复状态 |
|---------|---------|---------|---------|---------|
| 1.1 众筹页面内容验证 | | | | |
| 1.2 众筹项目列表 | | | | |
| 2.1 创建可资助实验 | | | | |
| 2.2 资助实验流程 | | | | |
| 2.3 多赞助商资助测试 | | | | |
| 3.1 未达资金目标的退款测试 | | | | |
| 3.2 达到资金目标时退款不可用测试 | | | | |
| 4.1 成功资助后的资金处理 | | | | |
| 4.2 平台费用累计验证 | | | | |
| 5.1 收益记录 | | | | |
| 5.2 季度收益分配 | | | | |
| 6.1 资金进度显示 | | | | |
| 6.2 金融政策信息显示 | | | | |
| 6.3 响应式设计测试 | | | | |

## 测试结果汇总

在完成所有测试后，请在此处汇总测试结果:

- 总测试用例数: 14
- 通过测试用例数: 
- 失败测试用例数: 
- 通过率: 

## 问题与建议

请在此处记录测试过程中发现的问题和改进建议:

1. [问题描述]
   - 严重程度: [高/中/低]
   - 复现步骤: [步骤]
   - 预期结果: [预期]
   - 实际结果: [实际]
   - 建议修复方案: [建议]
